/*!
  * @silen/sticky v0.0.1
  * (c) 2021
  * author: sunsilent
  * @license MIT
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Sticky=e()}(this,(function(){"use strict";function t(){return t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},t.apply(this,arguments)}!function(){for(var t=0,e=["webkit","moz"],s=0;s<e.length&&!window.requestAnimationFrame;++s)window.requestAnimationFrame=window[e[s]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[s]+"CancelAnimationFrame"]||window[e[s]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var s=Date.now(),i=Math.max(0,16.7-(s-t)),n=window.setTimeout((function(){e(s+i)}),i);return t=s+i,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var e=function(){function e(t,s){this.version="0.0.1",this.userAgent=window.navigator.userAgent,this.els=[],this.isWin=!1,this.rid=0;var i=void 0!==s?s:{};this.props={customStickyChangeNumber:i.customStickyChangeNumber||null,noStyles:i.noStyles||!1,stickyBitStickyOffset:i.stickyBitStickyOffset||0,parentClass:i.parentClass||"js-sticky-parent",scrollContainer:e.getScrollElement(i.scrollContainer),stickyClass:i.stickyClass||"js-is-sticky",stuckClass:i.stuckClass||"js-is-stuck",stickyChangeClass:i.stickyChangeClass||"js-is-sticky--change",useStickyClasses:i.useStickyClasses||!1,useFixed:i.useFixed||!1,useGetBoundingClientRect:i.useGetBoundingClientRect||!1,verticalPosition:i.verticalPosition||"top",applyStyle:i.applyStyle||function(t,s){return e.applyStyle(t,s)}},this.props.positionVal=e.definePosition(this.props)||"fixed",this.instances=[],this.manageElements(t)}var s=e.prototype;return s.manageElements=function(t){var e=this.props,s=e.positionVal,i=e.noStyles,n=e.stickyBitStickyOffset,o=e.verticalPosition,a="top"!==o||i?"":n+"px",r="fixed"!==s?s:"";this.els=Array.from("string"==typeof t?document.querySelectorAll(t):t);for(var l=0;l<this.els.length;l++){var c,p=this.els[l];if(p.parentNode){var f=this.addInstance(p,this.props);this.props.applyStyle({styles:(c={},c[o]=a,c.position=r,c),classes:{}},f),this.manageState(f),this.instances.push(f)}else console.warn("The target argument should not be root html")}},e.applyStyle=function(t,e){var s=t.styles,i=t.classes,n=e,o=n.el,a=n.props,r=o.style,l=a.noStyles,c=o.className.split(" ");for(var p in i){if(i[p])-1===c.indexOf(p)&&c.push(p);else{var f=c.indexOf(p);-1!==f&&c.splice(f,1)}}if(o.className=c.join(" "),s.position&&(r.position=s.position),!l)for(var u in s)r[u]=s[u]},e.definePosition=function(t){var e;if(t.useFixed)e="fixed";else{for(var s=["","-o-","-webkit-","-moz-","-ms-"],i=document.head.style,n=0;n<s.length;n+=1)i.position=s[n]+"sticky";e=i.position?i.position:"fixed",i.position=""}return e},e.getScrollElement=function(t){var e;if("string"==typeof t){if(!(e=document.querySelector(t)))throw new Error("The selector does not exists!");return e}return t||window},s.addInstance=function(t,s){var i=this,n={el:t,parent:t.parentNode,props:s};if("fixed"===s.positionVal||s.useStickyClasses){this.isWin=this.props.scrollContainer===window;var o=this.isWin?window:e.getClosestParent(n.el,n.props.scrollContainer);this.computeScrollOffsets(n),e.toggleClasses(n.parent,"",s.parentClass),n.state="default",n.stateChange="default";var a=function(){return i.manageState(n)};n.stateContainer=a,o.addEventListener("scroll",a)}return n},e.getClosestParent=function(t,e){var s=e,i=t;if(i.parentElement===s)return s;for(;i.parentElement!==s;)i=i.parentElement;return s},s.getTopPosition=function(t){if(this.props.useGetBoundingClientRect){var e=this.props.scrollContainer;return t.getBoundingClientRect().top+(e.pageYOffset||document.documentElement.scrollTop)}var s=0;do{s=t.offsetTop+s}while(t=t.offsetParent);return s},s.computeScrollOffsets=function(t){var e=t,s=e.props,i=e.el,n=e.parent,o=!this.isWin&&"fixed"===s.positionVal,a="bottom"!==s.verticalPosition,r=o?this.getTopPosition(s.scrollContainer):0,l=o?this.getTopPosition(n)-r:this.getTopPosition(n),c=null!==s.customStickyChangeNumber?s.customStickyChangeNumber:i.offsetHeight,p=l+n.offsetHeight;e.offset=o?0:r+s.stickyBitStickyOffset,e.stickyStart=a?l-e.offset:0,e.stickyChange=e.stickyStart+c,e.stickyStop=a?p-(i.offsetHeight+e.offset):p-window.innerHeight},e.toggleClasses=function(t,e,s){var i=t,n=i.className.split(" ");s&&-1===n.indexOf(s)&&n.push(s);var o=n.indexOf(e);-1!==o&&n.splice(o,1),i.className=n.join(" ")},s.manageState=function(e){var s=this,i=e,n=e.props,o=e.state,a=e.stateChange,r=e.stickyStart,l=e.stickyChange,c=e.stickyStop,p=n.stickyBitStickyOffset,f=n.positionVal,u=n.scrollContainer,d=n.stickyClass,y=n.stickyChangeClass,h=n.stuckClass,m=n.verticalPosition,g=n.applyStyle,C=n.noStyles,k="bottom"!==m,v=this.isWin?window.scrollY||window.pageYOffset:u.scrollTop,w=k&&v<=r&&("sticky"===o||"stuck"===o),S=v>=c&&"sticky"===o;v>r&&v<c&&("default"===o||"stuck"===o)?i.state="sticky":w?i.state="default":S&&(i.state="stuck");var x=v>=l&&v<=c;v<l/2||v>c?i.stateChange="default":x&&(i.stateChange="sticky"),o===i.state&&a===i.stateChange||(this.rid=window.requestAnimationFrame((function(){var n,o,a,r,l,c,u={sticky:{styles:(n={position:f,top:"",bottom:""},n[m]=p+"px",n),classes:(o={},o[d]=!0,o)},default:{styles:(a={},a[m]="",a),classes:{}},stuck:{styles:t((r={},r[m]="",r),"fixed"===f&&!C||!s.isWin?{position:"absolute",top:"",bottom:"0"}:{}),classes:(l={},l[h]=!0,l)}};"fixed"===f&&(u.default.styles.position="");var k=u[i.state];k.classes=((c={})[h]=!!k.classes[h],c[d]=!!k.classes[d],c[y]=x,c),g(k,e)})))},s.update=function(t){var e=this;return void 0===t&&(t=null),this.instances.forEach((function(s){if(e.computeScrollOffsets(s),t)for(var i in t)s.props[i]=t[i]})),this},e.removeInstance=function(t){var s,i,n=t.el,o=t.props;e.applyStyle({styles:(s={position:""},s[o.verticalPosition]="",s),classes:(i={},i[o.stickyClass]="",i[o.stuckClass]="",i)},t),e.toggleClasses(n.parentNode,o.parentClass,null)},s.cleanup=function(){for(var t=0;t<this.instances.length;t+=1){var s=this.instances[t];if(s.stateContainer)s.props.scrollContainer.removeEventListener("scroll",s.stateContainer);e.removeInstance(s)}window.cancelAnimationFrame(this.rid),this.instances=[]},e}();return function(t,s){return new e(t,s)}}));
